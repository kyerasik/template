(function(){wrapNodeStrings(document.querySelector('.page-title'),['string-width-animation','onload-animation']);var animationElements=querySelectorAsArray('.main-block .onload-animation, .works-list-block .onload-animation');var onloadAnimationStep=150;window.pageOnLoadAnimationCallback=function(){animateElements(animationElements,onloadAnimationStep);};window.pageOnLoadAnimationTimeout=(animationElements.length+1)*onloadAnimationStep;window.afterPageOnLoadAnimationCallback=function(){querySelectorAsArray('.page-title .string').forEach(function(string){string.classList.add('disable-animation-style');});};window.afterPageOnLoadAnimationTimeout=(animationElements.length+1)*onloadAnimationStep;var contentIsLoading=false,blockWorksLoading=false,worksLoadingUnblocked=false;var worksList=document.querySelector('.works-list');var $worksList=$(worksList);var stopYear=parseInt(worksList.dataset.stopYear);var requestUrl=mart_ajax.ajaxurl;var page=2;var works;var years=document.getElementById('years'),$years=$(years);function setupWorks(){works=Convert.nodeListToArray(worksList.querySelectorAll('.work'));}
setupWorks();if(parseInt(worksList.dataset.loadMore)){function maybeLoadMoreWorks(){if(contentIsLoading||blockWorksLoading)return;var worksListRect=worksList.getBoundingClientRect();var fromWorksListBottomToWindowBottom=worksListRect.bottom-window.innerHeight;if(fromWorksListBottomToWindowBottom<window.innerHeight){contentIsLoading=true;$.post({url:requestUrl,data:{page:page,action:'ajax_portfolio',term:worksList.dataset.term}}).done(function(request,status,xhr){++page;if(request!==''){$worksList.append(request);refreshAnimatedBlocks();changePageBackground();yearsChange();}
if(xhr.getResponseHeader('HasMoreItems')==0){window.removeEventListener('scroll',maybeLoadMoreWorks,scrollEventListenerThirdArgument);}
setupWorks();contentIsLoading=false;var lastWorkYear=works[works.length-1].dataset.year;if(!worksLoadingUnblocked&&worksList.dataset.term===''&&lastWorkYear<=stopYear){blockWorksLoading=true;var loadMoreButtonContainer=document.createElement('div');loadMoreButtonContainer.classList.add('load-more-button-container');var loadMoreButton=document.createElement('button');loadMoreButton.textContent=worksList.dataset.buttonText;loadMoreButton.type='button';loadMoreButton.classList.add('button');loadMoreButton.classList.add('black');loadMoreButton.classList.add('load-more-button');loadMoreButton.addEventListener('click',function(){worksLoadingUnblocked=true;blockWorksLoading=false;maybeLoadMoreWorks();worksList.removeChild(loadMoreButtonContainer);});loadMoreButtonContainer.appendChild(loadMoreButton);worksList.appendChild(loadMoreButtonContainer);}});}}
maybeLoadMoreWorks();window.addEventListener('scroll',maybeLoadMoreWorks,scrollEventListenerThirdArgument);}
function yearsChange(){if(isDesktop()){works.forEach(function(item){var itemTop=item.getBoundingClientRect().top;if(itemTop>0&&itemTop<window.innerHeight*0.5){years.textContent=item.dataset.year;return false;}});}}
years.textContent=works[0].dataset.year;yearsChange();window.addEventListener('scroll',yearsChange,scrollEventListenerThirdArgument);var stickInitialized=false;function setStick(){if(isDesktop()){if(!stickInitialized){$years.stick_in_parent({offset_top:window.innerHeight/2});stickInitialized=true;}else{$years.trigger("sticky_kit:detach");$years.stick_in_parent({offset_top:window.innerHeight/2});}}else{if(stickInitialized){$years.trigger("sticky_kit:detach");stickInitialized=false;}}}
setStick();window.addEventListener('resize',setStick);})();